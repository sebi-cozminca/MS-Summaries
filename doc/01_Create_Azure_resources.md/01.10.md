---
title: '10: TechLab: Build and Deploy AI Agents with MCP and Azure Functions`
layout: default
nav_order: 10
parent: 'Lab summaries'
--- 

# Lab Metadata & Summary

**ID** 186838  
**Number:** LAB344  
**Name:** TechLab: Build and Deploy AI Agents with MCP and Azure Functions  
**CloudSubscriptionPoolName:** Microsoft Event Subscription (CSS)  
**AllowSave:** False  
**CloudCredentialPoolAssignments:** Setup Config Files, '@lab.CloudResourceGroup(RESOURCE_GROUP_NAME).Name'
                                                   
                                                   $mongoConn = 'mongodb+srv://mongoAdminUser:Pwd!'+$labId+'@mongodb'+$labId+'.mongocluster.cosmos.azure.com/?tls=true'
                                                   $mongoConn2 = 'mongodb+srv://mongoAdminUser@mongodb'+$labId+'.mongocluster.cosmos.azure.com'
                                                   $mongoPassword = 'Pwd!'+$labId
                                                   $openAIName = 'openai'+ $labId 
                                                   
                                                   $envContent = @"
                                                   labId = $labId
                                                   username = $username
                                                   password= $password
                                                   subscription = $subscription
                                                   rgName = $rgName
                                                   openAIName = $openAIName
                                                   mongoConn = $mongoConn
                                                   "@
                                                   $envFilePath = "C:\Code\variables.txt"
                                                   $envContent | Set-Content -Path $envFilePath
                                                   
                                                   $AzCredential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList ($username, (ConvertTo-SecureString -AsPlainText -Force -String $password))
                                                   Connect-AzAccount -Credential $AzCredential
                                                   
                                                   # Force Subscription Context
                                                   Set-AzContext -Subscription $subscription 
                                                   
                                                   # Register Providers
                                                   Register-AzResourceProvider -ProviderNamespace Microsoft.CognitiveServices
                                                   
                                                   # Assign CS User Owner Perms to contoso-chat-rg
                                                   $CogServRole = Get-AzRoleDefinition -Name "Cognitive Services Contributor"
                                                   $user = Get-AzADUser -UserPrincipalName $username
                                                   $userID = $user.Id
                                                   $resourceGroup = Get-AzResourceGroup -Name $rgName
                                                   
                                                   New-AzRoleAssignment -ObjectId $userID -RoleDefinitionName $CogServRole.Name
                                                   
                                                   # Once Deployment Complete, Write to ENV
                                                   $openAiEndpoint = (Get-AzCognitiveServicesAccount -Name $openAiName -ResourceGroupName $rgName).Endpoint
                                                   $openAiApiKey = (Get-AzCognitiveServicesAccountKey -Name $openAIName -ResourceGroupName $rgName).Key1
                                                   
                                                   # Write to env file
                                                   $envContent = @", Purge AI Resources, Purge AI on Launch, Clone Git Repos  
**Additional licenses:** NA  

---

## Exercise Summary
### Exercise Summary
- **Setup:** Pre-provisioned environment with Cognitive Services and MongoDB Cosmos DB.
- **Configuration:** PowerShell script writes env variables (subscription, OpenAI endpoint/key, Mongo connection) to `variables.txt`.
- **Deploy AI Agent:** Build AI agent using MCP framework and Azure Functions.
- **Outcome:** Students learn to integrate MCP with Azure Functions for intelligent apps.

